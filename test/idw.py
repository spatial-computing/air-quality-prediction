import math

R = 6373.0


def geo_distance(lon1, lat1, lon2, lat2):
    dlat = math.radians(lat2 - lat1)
    dlon = math.radians(lon2 - lon1)
    a = math.sin(dlat / 2) * math.sin(dlat / 2) + math.cos(math.radians(lat1)) \
        * math.cos(math.radians(lat2)) * math.sin(dlon / 2) * math.sin(dlon / 2)
    c = 2 * math.atan2(math.sqrt(a), math.sqrt(1 - a))
    return R * c


def get_weight(lon, lat, points):
    weights = {}
    for point, gid in points.items():
        weights[gid] = 1 / geo_distance(lon, lat, point[0], point[1])
    return weights


def idw(lon, lat, weights, values):
    value_sum = 0.0
    weight_sum = 0.0
    for gid, value in values.items():
        value_sum += value * weights[gid]
        weight_sum += weights[gid]
    return value_sum / weight_sum


# (x, y) : gid
points = {
	(-117.8026453,34.22015405): 1392, 
	(-118.2219415,34.26363783): 1537, 
	(-118.3425385,33.84260276): 120, 
	(-118.1166862,33.97361034): 366, 
	(-118.2747961,34.39410841): 2051, 
	(-117.8902415,34.01714283): 501, 
	(-117.9773746,33.95915602): 336, 
	(-118.3806709,34.58243518): 2847, 
	(-118.1695168,34.26372258): 1540, 
	(-117.9772802,34.30736537): 1720, 
	(-118.2051085,34.52482416): 2604, 
	(-118.2035113,33.87193489): 169, 
	(-118.0471183,34.13325328): 1021, 
	(-118.467401,34.40802779): 2099, 
	(-118.1524925,34.51039306): 2544, 
	(-118.5374209,34.40773772): 2095, 
	(-118.2925021,34.45210187): 2290, 
	(-118.5197349,34.37879704): 1978, 
	(-117.8901844,34.06066889): 688, 
	(-118.4305164,34.04544265): 587, 
	(-118.3626228,34.4664213): 2347, 
	(-117.9773707,33.97366464): 374, 
	(-118.13431,34.10417034): 882, 
	(-118.4328431,34.49520863): 2466, 
	(-118.2225994,34.51028477): 2540, 
	(-117.8202361,34.16214634): 1163, 
	(-118.4310396,34.14700281): 1064, 
	(-117.8021985,34.40876716): 2137, 
	(-117.7854032,34.13307197): 1036, 
	(-118.6262538,34.58141782): 2833, 
	(-117.6801627,34.27792761): 1624, 
	(-118.239583,34.32163934): 1762
}
# gid: value
values = {
	1392: 24.8, 
	1537: 24.16, 
	120: 46.0, 
	366: 38.44, 
	2051: 23.72, 
	501: 35.28, 
	336: 25.36, 
	2847: 28.72, 
	1540: 23.08, 
	1720: 22.84, 
	2604: 23.88, 
	169: 43.12, 
	1021: 41.28, 
	2099: 32.6, 
	2544: 23.52, 
	2095: 33.92, 
	2290: 23.84, 
	1978: 31.04, 
	688: 36.28, 
	587: 42.12, 
	2347: 23.68, 
	374: 31.16, 
	882: 37.88, 
	2466: 24.76, 
	2540: 24.08, 
	1163: 24.12, 
	1064: 37.28, 
	2137: 22.6, 
	1036: 36.56, 
	2833: 24.76, 
	1624: 22.48, 
	1762: 23.8
}

x, y = -118, 34.5
weight = get_weight(x, y, points)
print(idw(x, y, weight, values))